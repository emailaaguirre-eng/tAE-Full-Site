/*! For license information please see design-editor.js.LICENSE.txt */
(()=>{"use strict";var e={20:(e,r,t)=>{var n=t(594),o=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function i(e,r,t){var n,i={},c=null,d=null;for(n in void 0!==t&&(c=""+t),void 0!==r.key&&(c=""+r.key),void 0!==r.ref&&(d=r.ref),r)a.call(r,n)&&!s.hasOwnProperty(n)&&(i[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===i[n]&&(i[n]=r[n]);return{$$typeof:o,type:e,key:c,ref:d,props:i,_owner:l.current}}r.jsx=i,r.jsxs=i},206:e=>{e.exports=ReactDOM},338:(e,r,t)=>{var n=t(206);r.H=n.createRoot,n.hydrateRoot},594:e=>{e.exports=React},848:(e,r,t)=>{e.exports=t(20)}},r={};function t(n){var o=r[n];if(void 0!==o)return o.exports;var a=r[n]={exports:{}};return e[n](a,a.exports,t),a.exports}var n,o,a,l=t(594),s=t(338),i=t(848);function c(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function a(t,n,o,a){var i=n&&n.prototype instanceof s?n:s,c=Object.create(i.prototype);return d(c,"_invoke",function(t,n,o){var a,s,i,c=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(r,t){return a=r,s=0,i=e,p.n=t,l}};function f(t,n){for(s=t,i=n,r=0;!u&&c&&!o&&r<d.length;r++){var o,a=d[r],f=p.p,x=a[2];t>3?(o=x===n)&&(i=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=t<2&&f<a[1])?(s=0,p.v=n,p.n=a[1]):f<x&&(o=t<3||a[0]>n||n>x)&&(a[4]=t,a[5]=n,p.n=x,s=0))}if(o||t>1)return l;throw u=!0,n}return function(o,d,x){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&f(d,x),s=d,i=x;(r=s<2?e:i)||!u;){a||(s?s<3?(s>1&&(p.n=-1),f(s,i)):p.n=i:p.v=i);try{if(c=2,a){if(s||(o="next"),r=a[o]){if(!(r=r.call(a,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,s<2&&(s=0)}else 1===s&&(r=a.return)&&r.call(a),s<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((r=(u=p.n<0)?i:t.call(n,p))!==l)break}catch(r){a=e,s=1,i=r}finally{c=1}}return{value:r,done:u}}}(t,o,a),!0),c}var l={};function s(){}function i(){}function u(){}r=Object.getPrototypeOf;var p=[][n]?r(r([][n]())):(d(r={},n,function(){return this}),r),f=u.prototype=s.prototype=Object.create(p);function x(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,d(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return i.prototype=u,d(f,"constructor",u),d(u,"constructor",i),i.displayName="GeneratorFunction",d(u,o,"GeneratorFunction"),d(f),d(f,o,"Generator"),d(f,n,function(){return this}),d(f,"toString",function(){return"[object Generator]"}),(c=function(){return{w:a,m:x}})()}function d(e,r,t,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}d=function(e,r,t,n){function a(r,t){d(e,r,function(e){return this._invoke(r,t,e)})}r?o?o(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(a("next",0),a("throw",1),a("return",2))},d(e,r,t,n)}function u(e,r,t,n,o,a,l){try{var s=e[a](l),i=s.value}catch(e){return void t(e)}s.done?r(i):Promise.resolve(i).then(n,o)}function p(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var a=e.apply(r,t);function l(e){u(a,n,o,l,s,"next",e)}function s(e){u(a,n,o,l,s,"throw",e)}l(void 0)})}}function f(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a,l,s=[],i=!0,c=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;i=!1}else for(;!(i=(n=a.call(t)).done)&&(s.push(n.value),s.length!==r);i=!0);}catch(e){c=!0,o=e}finally{try{if(!i&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(c)throw o}}return s}}(e,r)||function(e,r){if(e){if("string"==typeof e)return x(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?x(e,r):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}var m=(null===(n=window.ArtKeyDesignEditor)||void 0===n?void 0:n.rest)||{save:"/wp-json/artkey-design/v1/save",get:"/wp-json/artkey-design/v1/get",options:"/wp-json/artkey-design/v1/options",calculate:"/wp-json/artkey-design/v1/calculate-price"},b=(null===(o=window.ArtKeyDesignEditor)||void 0===o?void 0:o.nonce)||"",y=(null===(a=window.ArtKeyDesignEditor)||void 0===a?void 0:a.gelatoApiKey)||"",h="#ECECE9",v="#FFFFFF",g="#353535";function j(e){var r=e.productId,t=e.productType,n=void 0===t?"print":t,o=f((0,l.useState)("upload"),2),a=o[0],s=o[1],d=f((0,l.useState)(null),2),u=d[0],x=d[1],j=f((0,l.useState)({sizes:[],materials:[],frames:[]}),2),S=j[0],O=j[1],_=f((0,l.useState)(null),2),P=_[0],C=_[1],E=f((0,l.useState)(null),2),A=E[0],F=E[1],T=f((0,l.useState)(null),2),I=T[0],D=T[1],G=f((0,l.useState)(!1),2),R=G[0],U=G[1],z=f((0,l.useState)(null),2),M=z[0],W=z[1];(0,l.useEffect)(function(){B()},[r]);var B=function(){var e=p(c().m(function e(){var t,n,o,a,l,s;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(m.options,"/").concat(r||0));case 1:if(!(t=e.v).ok){e.n=3;break}return e.n=2,t.json();case 2:l=e.v,O({sizes:l.sizes||[],materials:l.materials||[],frames:l.frames||[]}),null!==(n=l.sizes)&&void 0!==n&&n.length&&C(l.sizes[0]),null!==(o=l.materials)&&void 0!==o&&o.length&&F(l.materials[0]),null!==(a=l.frames)&&void 0!==a&&a.length&&D(l.frames[0]);case 3:e.n=5;break;case 4:e.p=4,s=e.v,console.error("Failed to load options",s);case 5:return e.a(2)}},e,null,[[0,4]])}));return function(){return e.apply(this,arguments)}}(),K=function(){var e=p(c().m(function e(r){var t,n,o,a,l,s;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=null===(t=r.target.files)||void 0===t?void 0:t[0]){e.n=1;break}return e.a(2);case 1:return(o=new FormData).append("file",n),e.p=2,e.n=3,fetch("/wp-json/artkey/v1/upload",{method:"POST",headers:{"X-WP-Nonce":b},body:o});case 3:if(!(a=e.v).ok){e.n=5;break}return e.n=4,a.json();case 4:l=e.v,x(l.url);case 5:e.n=7;break;case 6:e.p=6,s=e.v,console.error("Upload failed:",s),alert("Failed to upload image");case 7:return e.a(2)}},e,null,[[2,6]])}));return function(r){return e.apply(this,arguments)}}(),L=function(){var e=p(c().m(function e(){var t,n,o;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(P){e.n=1;break}return e.a(2);case 1:return U(!0),e.p=2,e.n=3,fetch(m.calculate,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":b},body:JSON.stringify({product_id:r,size:P,material:A,frame:I})});case 3:if(!(t=e.v).ok){e.n=5;break}return e.n=4,t.json();case 4:n=e.v,W(n.price||null);case 5:e.n=7;break;case 6:e.p=6,o=e.v,console.error("Calc failed",o);case 7:return e.p=7,U(!1),e.f(7);case 8:return e.a(2)}},e,null,[[2,6,7,8]])}));return function(){return e.apply(this,arguments)}}(),$=function(){var e=p(c().m(function e(){var t;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(m.save,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":b},body:JSON.stringify({product_id:r,product_type:n,design_data:{image:u,size:P,material:A,frame:I,gelatoApiKey:y}})});case 1:e.v.ok&&(alert("Design saved!"),window.location.href="/checkout/"),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Save failed:",t),alert("Failed to save design");case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}();return(0,i.jsxs)("div",{className:"fixed inset-0 z-50 flex",style:{background:h},children:[(0,i.jsxs)("div",{className:"w-80 bg-white border-r border-[#d8d8d6] flex flex-col shadow-2xl",children:[(0,i.jsxs)("div",{className:"p-5 border-b border-[#e2e2e0]",style:{background:v},children:[(0,i.jsx)("h2",{className:"text-xl font-bold font-playfair",style:{color:g},children:"Design Editor"}),(0,i.jsx)("p",{className:"text-sm mt-1",style:{color:"#555"},children:P?"".concat(P.name||P):n})]}),(0,i.jsxs)("div",{className:"grid grid-cols-4 gap-1 p-2",style:{background:h,borderBottom:"1px solid #e2e2e0"},children:[(0,i.jsxs)("button",{onClick:function(){return s("upload")},className:"flex flex-col items-center justify-center py-3 px-2 rounded-lg transition-all",style:"upload"===a?{background:v,color:g,boxShadow:"0 2px 6px rgba(0,0,0,0.08)",border:"1px solid #d8d8d6"}:{color:"#666"},children:[(0,i.jsx)("span",{className:"text-2xl mb-1",children:"ðŸ“¤"}),(0,i.jsx)("span",{className:"text-[10px] font-medium",children:"Upload"})]}),(0,i.jsxs)("button",{onClick:function(){return s("options")},className:"flex flex-col items-center justify-center py-3 px-2 rounded-lg transition-all",style:"options"===a?{background:v,color:g,boxShadow:"0 2px 6px rgba(0,0,0,0.08)",border:"1px solid #d8d8d6"}:{color:"#666"},children:[(0,i.jsx)("span",{className:"text-2xl mb-1",children:"ðŸ“"}),(0,i.jsx)("span",{className:"text-[10px] font-medium",children:"Options"})]}),(0,i.jsxs)("button",{onClick:function(){return s("ai")},className:"flex flex-col items-center justify-center py-3 px-2 rounded-lg transition-all",style:"ai"===a?{background:v,color:g,boxShadow:"0 2px 6px rgba(0,0,0,0.08)",border:"1px solid #d8d8d6"}:{color:"#666"},children:[(0,i.jsx)("span",{className:"text-2xl mb-1",children:"âœ¨"}),(0,i.jsx)("span",{className:"text-[10px] font-medium",children:"AI"})]}),(0,i.jsxs)("button",{onClick:function(){return s("preview")},className:"flex flex-col items-center justify-center py-3 px-2 rounded-lg transition-all",style:"preview"===a?{background:v,color:g,boxShadow:"0 2px 6px rgba(0,0,0,0.08)",border:"1px solid #d8d8d6"}:{color:"#666"},children:[(0,i.jsx)("span",{className:"text-2xl mb-1",children:"ðŸ‘ï¸"}),(0,i.jsx)("span",{className:"text-[10px] font-medium",children:"Preview"})]})]}),(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",style:{background:v},children:["upload"===a&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"border-2 border-dashed border-[#d8d8d6] rounded-xl p-8 text-center",style:{background:h},children:[(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:K,className:"hidden",id:"design-upload"}),(0,i.jsx)("label",{htmlFor:"design-upload",className:"inline-block px-6 py-3 rounded-full font-semibold cursor-pointer transition-all",style:{background:g,color:"#fff"},children:"Upload Image"}),(0,i.jsx)("p",{className:"text-xs mt-2",style:{color:"#666"},children:"JPG, PNG up to 10MB"})]}),u&&(0,i.jsx)("div",{className:"relative",children:(0,i.jsx)("img",{src:u,alt:"Uploaded design",className:"w-full rounded-lg border border-[#d8d8d6]"})})]}),"options"===a&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(w,{title:"Size",children:(0,i.jsx)(k,{options:S.sizes,selected:P,onSelect:C})}),(0,i.jsx)(w,{title:"Material",children:(0,i.jsx)(k,{options:S.materials,selected:A,onSelect:F})}),(0,i.jsx)(w,{title:"Frame",children:(0,i.jsx)(k,{options:S.frames,selected:I,onSelect:D})}),(0,i.jsx)("button",{onClick:L,className:"w-full py-3 rounded-lg font-semibold transition-all",style:{background:g,color:"#fff"},children:R?"Calculating...":"Update Price"}),null!==M&&(0,i.jsxs)("div",{className:"text-lg font-semibold text-center",style:{color:g},children:["Estimated: $",M]})]}),"ai"===a&&(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)(w,{title:"AI Studio",children:[(0,i.jsx)(N,{label:"Background Removal"}),(0,i.jsxs)("div",{className:"mt-3",children:[(0,i.jsx)("h4",{className:"text-sm font-semibold mb-2",style:{color:g},children:"Art Styles"}),(0,i.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["Van Gogh","Monet","Picasso","Warhol","Pencil","Watercolor","Cartoonify","Rotoscope"].map(function(e){return(0,i.jsx)("div",{className:"px-3 py-2 rounded-lg border border-[#d8d8d6] text-sm text-center",style:{background:v,color:g},children:e},e)})})]}),(0,i.jsx)(N,{label:"Face Detection"})]})}),"preview"===a&&(0,i.jsxs)("div",{className:"space-y-2 text-sm",style:{color:"#555"},children:[(0,i.jsx)("p",{children:"Preview your design on the right. Use Upload and Options to adjust."}),y?(0,i.jsx)("p",{className:"text-green-700",children:"Gelato API key detected."}):(0,i.jsx)("p",{className:"text-amber-700",children:"Gelato API key not set. Add it in the plugin settings."})]})]}),(0,i.jsxs)("div",{className:"p-4 border-t border-[#e2e2e0]",style:{background:h},children:[(0,i.jsx)("button",{onClick:$,className:"w-full py-3 rounded-lg font-semibold transition-all",style:{background:g,color:"#fff"},children:"Save Design"}),(0,i.jsx)("button",{onClick:function(){return window.history.back()},className:"w-full mt-2 py-2 rounded-lg transition-all",style:{border:"1px solid #d8d8d6",color:"#555",background:v},children:"Cancel"})]})]}),(0,i.jsx)("div",{className:"flex-1 flex items-center justify-center",style:{background:h},children:(0,i.jsx)("div",{className:"rounded-lg shadow-2xl p-6 border border-[#d8d8d6]",style:{background:v},children:u?(0,i.jsx)("img",{src:u,alt:"Design preview",className:"max-w-full max-h-[80vh] object-contain rounded",style:{background:"#f8f8f6"}}):(0,i.jsx)("div",{className:"w-[480px] h-[480px] flex items-center justify-center border-2 border-dashed border-[#d8d8d6] rounded-lg",style:{background:"#f8f8f6"},children:(0,i.jsx)("p",{className:"text-gray-500",children:"Upload an image to preview"})})})})]})}function w(e){var r=e.title,t=e.children;return(0,i.jsxs)("div",{className:"bg-white rounded-2xl border border-[#e2e2e0] p-4 shadow-sm",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold mb-3",style:{color:g},children:r}),t]})}function k(e){var r=e.options,t=void 0===r?[]:r,n=e.selected,o=e.onSelect;return(0,i.jsx)("div",{className:"grid grid-cols-2 gap-2",children:t.map(function(e,r){var t=e.label||e.name||e,a=n&&(n.value===e.value||n===e);return(0,i.jsxs)("button",{onClick:function(){return o(e)},className:"px-3 py-2 rounded-lg border text-sm text-left transition-all",style:a?{borderColor:g,background:"#f5f5f3",color:g,boxShadow:"0 2px 6px rgba(0,0,0,0.08)"}:{borderColor:"#d8d8d6",color:"#555",background:v},children:[t,void 0!==e.price&&(0,i.jsxs)("span",{className:"block text-xs",style:{color:"#777"},children:["$",e.price]})]},r)})})}function N(e){var r=e.label;return(0,i.jsx)("button",{className:"w-full py-3 rounded-xl font-semibold transition-all",style:{background:g,color:"#fff",boxShadow:"0 4px 10px rgba(0,0,0,0.08)"},children:r})}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("design-editor-root");if(e){var r=e.getAttribute("data-product-id"),t=e.getAttribute("data-product-type")||"canvas";(0,s.H)(e).render((0,i.jsx)(j,{productId:r,productType:t}))}})})();